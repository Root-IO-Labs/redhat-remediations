# Dockerfile for testing UNPATCHED expat (CVE-2025-59375 vulnerable)
# Uses stock UBI10 expat package without CVE fix

FROM registry.access.redhat.com/ubi10/ubi:latest

LABEL description="UBI10 with UNPATCHED expat for CVE-2025-59375 testing"
LABEL cve="CVE-2025-59375"
LABEL status="vulnerable"

# Install build tools and stock expat (unpatched)
RUN dnf -y update && \
    dnf -y install \
        gcc \
        make \
        expat \
        expat-devel \
    && dnf clean all

# Show expat version
RUN echo "=== Unpatched expat version ===" && \
    rpm -q expat && \
    strings /usr/lib64/libexpat.so.1 | grep expat_2

# Copy PoC test
WORKDIR /poc
COPY poc/test_cve_2025_59375.c /poc/

# Compile test
RUN gcc -o test_cve test_cve_2025_59375.c -lexpat -Wall

# Default command runs the test
CMD ["./test_cve"]
